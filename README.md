# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Об архитектуре

Для реализации проекта использован паттерн проектирования MVP.

**Model** - Модель, позволяет хранить и изменять данные.

**View** - Вид, отобраджает данные на странице.

**Presenter** - Презенер, связывает между собой вид и модель в реагируя на действия пользователя.

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

## Базовый код

### Component

Дженерик, родительский класс всех элементов представлений.

_Конструктор_:

Конструктор получает один параметр `container: HTMLElement` - DOM контейнер типа HTMLElement и записывет его значение в защищенноей свойство `container`, доступное только для чтения.

_Методы_:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - Переключает класс
- `setText(element: HTMLElement, value: unknown)` - Установить текстовое содержимое
- `setDisabled(element: HTMLElement, state: boolean)` - Сменить статус блокировки
- `setHidden(element: HTMLElement)` - Скрыть
- `setVisible(element: HTMLElement)` - Показать
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - Установить изображение с алтернативным текстом
- `addClass(element: HTMLElement, tokens: string)` - Добавить класс
- `render(data?: Partial<T>): HTMLElement` - Вернуть корневой DOM-элемент

### Api

Базовая логика отправки, получения и обработки запросов.

_Конструктор_:

Получает два параметра:

- `baseUrl:string` - строка с адресом для запроса и записывает её значение в публичное свойство `baseUrl`, доступное только для чтения.

- `options:RequestInit` - объект с настройками типа RequestInit, помещается в одноимённое свойство.

_Методы_:

- `get(uri: string)` - отправляет `GET` запрос на `uri` и возвращает `Promise<object>`
- `post(uri: string, data: object, method: ('POST' | 'PUT' | 'DELETE') )` - отправляет запрос типа `method` на `uri` с данными объека `data`
- `handleResponse(response: Response)` - приватная функция обработки ответа на запрос. Возвраящает `Promise<object>`

### EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

_Конструктор_

Записывает в свойство `_events` экземпляр объекта Map для хранения перечень событий и подписчиков.

_Методы_:

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` — Установить обработчик на событие
- `off(eventName: EventName, callback: Subscriber)` — Снять обработчик с события
- `emit<T extends object>(eventName: string, data?: T)` - Инициировать событие с данными
- `onAll(callback: (event: EmitterEvent) => void)` - Слушать все события
- `offAll()` - Сбросить все события
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - Сделать коллбек триггер, генерирующий событие при вызове

## Основные типы данных

**Товар получаемый от Api**

```ts
type TProduct = {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
};
```

**Данные для отправки заказа**

```ts
type TOrder = {
	payment: string;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
};
```

**Ответ Api на заказ**

```ts
type TOrderResult = {
	id: string;
	total: number;
};
```

## Модели

### App

Модель хранит в себе состояние приложения

```ts
export interface IAppModel {
	items: CatalogItem[]; // Список товаров полученный с сервера
	basket: TBasket; // Корзина товаров
	preview: string | null; // Выбранный товар
	order: TOrder | null; // Содержимое заказа
	formErrors: FormErrors; // Ошибки валидации форм
}
```

Методы:

- `setCatalog` - Заполняет items объекта App товарами и вызывает событие _catalog:update_
- `setPreview` - Устанавливает id выбранного для отображения в модальном окне товара, вызывает _preview:changed_
- `addToBasket` - Добавляет товар в корзину, вызывает _preview:changed_ и _basket:changed_
- `removeFromBasket` - Удаляет товар из корзины, вызывает _preview:changed_ и _basket:changed_
- `setOrderField` - Записыает в модель содержимое полей формы оформления заказа
- `setContactsField` - Записыает в модель содержимое полей формы с контактами
- `setOrderData` - Вызвается по окончании оформления заказа и заполняет order данными для отправки
- `setOrderPayment` - Записывает в модель тип оплаты
- `validateOrder` - Проверка полей формы оформления закза
- `validateContacts` - Проверка полей формы контактов
- `clearBasket()` - Очистка корзины

### CatalogItem

Расширяет полученный от Api объект параметрами:

- `categoryClass` - геттер, возвращающий строку содержащую стиль для категории товар
- `inBasket` - состояние для кнопки добавления или удаления из корзины

### LarekApi

Расширяет базовый класс `Api` функциями необходимыми для отправки и получения данных с сервера, а именно:

```ts
interface ILarekApiModel {
	getProduct: (id: string) => Promise<TProduct>; // Получает промис с данными о товаре
	getProductList: () => Promise<TProduct[]>; // Получает промис со списком товаров для витрины
	placeOrder: (order: TOrder) => Promise<TOrderResult>; // Отправляет данные заказа, получает результат запроса
}
```

## Представления

Все представления расширяют базовый компонент вида `Component`.

### Page

Отображает каталог товаров, счетчик товаров и кнопку корзины.

_Конструктор_:

- `container` - DOM контейнер с шаблоном модального окна
- `events`- Перечень событий брокера событий

_Элементы_:

- `_counter` - конейнер счётчика иконки корзины
- `_catalog` - конейнер галереи
- `_basket` - конейнер корзины, который будет кнопкой

### Modal

Отображает базовое модальное окно, содержит логику закрытия при клике на кнопу или вне модального окна.

_Конструктор_:

- `container` - DOM контейнер с шаблоном модального окна
- `events`- Перечень событий брокера событий

_Элементы_:

- `_closeButton` - Кнопка закрытия модального окна
- `_content`- Контейнер для содержимого модально окна

### Card

Отображает карточку товара в разных элементах страницы

_Конструктор_:

- `blockName` - Название основного элемента блока
- `container` - DOM контейнер с шаблоном карточки товара
- `actions` - События, которые необходимо навесить при нажатии на катрочку или кнопку в карточке

_Элементы_:

- `_index` - Номер товара в корзине
- `_title` - Наименование товра
- `_image` - Путь к изображению товара
- `_category` - Категория товара
- `_description` - Описание товара
- `_price` - Цена товара
- `_button` - Элемент кнопки

### Basket

Отображает содержимое корзины в модальном окне.
_Конструктор_:

- `container` - DOM контейнер с окна корзины
- `events`- Перечень событий брокера событий

_Элементы_:

- `_items` - Контейнер для перечня товаров в корзине
- `_total` - Элемент с суммой товаро в корзине
- `_button` - Кнопка перехода к оформлению заказа

### OrderForm

Отображает форму с адресом и типом оплаты в модальном окне

_Конструктор_:

- `container` - DOM контейнер с окна оформления заказа
- `events`- Перечень событий брокера событий

_Элементы_:

- `_typeCash` - Кнопка выбора оплаты наличными
- `_typeCard` - Кнопка выбора оплаты картой

### ContactsForm

Отображает форму конактов в модальном окне

_Конструктор_:

- `container` - DOM контейнер с окна контактов
- `events`- Перечень событий брокера событий

_Элементы_:

### Success

Отображает сообщение об успешном заказе в модальном окне

_Конструктор_:

- `blockName` - Название основного элемента блока
- `container` - DOM контейнер с шаблоном карточки товара
- `actions` - События, которые необходимо навесить при нажатии на катрочку

_Элементы_:

- `_total` - Элемент для отображения суммы заказа
- `_close` - Кнопка выхода из окна подтверждения заказа

## Отслеживаемые события

`catalog:update` - Загрузка принятх от сервера товаров в каталог

`card:select` - Выбор товара для отображения

`preview:changed` - Заполнение модального окна данными выбраного товара

`basket:open` - Окрытие модального окна с корзиной

`basket:add` - Добавление товара в корзину

`basket:remove` - Удаление товара из корзины

`card:remove` - Удалетние товара из картоки товара

`basket:changed` - Пересчёт корзины

`order:open` - Открытие модального окна с формой с типом оплаты и адресом

`/^order\..*:change/` - - Проверка корректности полей при заполнении формы

`order:validate` - Проверка формы типа оплаты и адреса

`order:submit` - Переход к форме контактов

`/^contacts\..*:change/` - Проверка корректности полей при заполнении формы

`contacts:validate` - Проверка ошибок в форме контактов, если нет, то следующий шаг

`contacts:submit` - Отправка данных заказа на сервер и обработка ответа

`modal:open` - Блокирует прокрутку страницы при открытом модальном окне

`modal:close` - Разблокирует прокрутку при закрытии модального окна
